<p></p><p>DECLARE @dbName NVARCHAR(200);</p><p>SET @dbName=&#39;DB1_SNAP&#39;</p><p>&nbsp;</p><p>BEGIN TRY</p><p>--=====================================</p><p>--查找当前数据库所有连接并删除</p><p>&nbsp;</p><p>DECLARE @spid INT;</p><p>DECLARE @tempSQL NVARCHAR(200);</p><p>--判断临时表是否存在，存在则删除</p><p>IF(OBJECT_ID(&#39;tempdb.dbo.#temp&#39;,&#39;U&#39;) IS NOT NULL)</p><p>BEGIN</p><p>DROP TABLE #temp</p><p>END</p><p>--查找活动的SPID</p><p>SELECT spid INTO #temp</p><p>FROM master.sys.sysprocesses</p><p>WHERE dbid =DB_ID(@dbName);</p><p>--循环并删除所有活动SPID</p><p>WHILE((SELECT COUNT(1) FROM #temp)&gt;0)</p><p>BEGIN</p><p>&nbsp; &nbsp;SELECT TOP(1) @spid=spid FROM #temp;</p><p>&nbsp; &nbsp;SET @tempSQL=&#39;KILL &#39;+CAST(@spid AS VARCHAR(10));</p><p>&nbsp; &nbsp;PRINT @tempSQL;</p><p>&nbsp; &nbsp;EXEC(@tempSQL);</p><p>&nbsp; &nbsp;DELETE FROM #temp WHERE spid=@spid;</p><p>END</p><p>DROP TABLE #temp</p><p>--========================================</p><p>--删除数据库</p><p>EXEC(&#39;DROP DATABASE &#39;+@dbName);</p><p>PRINT &#39;删除成功&#39;;</p><p>END TRY</p><p>BEGIN CATCH</p><p>PRINT &#39;执行出错，错误信息：&#39;</p><p>PRINT ERROR_MESSAGE()</p><p>END CATCH</p>