<p></p><p style="white-space: normal; orphans: 2; widows: 2;">--==============================================================</p><p style="white-space: normal; orphans: 2; widows: 2;">--查看数据库中各表占内存情况</p><p style="font-size: 16px; white-space: normal; orphans: 2; widows: 2;"><span style="font-size: 14px;">SELECT name AS TabelName,</span></p><p style="font-size: 16px; white-space: normal; orphans: 2; widows: 2;"><span style="font-size: 14px;">index_id AS IndexId,</span></p><p style="font-size: 16px; white-space: normal; orphans: 2; widows: 2;"><span style="font-size: 14px;">COUNT(*)AS CachedPageCount,</span></p><p style="font-size: 16px; white-space: normal; orphans: 2; widows: 2;"><span style="font-size: 14px;">CAST(COUNT(*)*8.0/1024 AS INT) AS CachedMemoryMB&nbsp;</span></p><p style="font-size: 16px; white-space: normal; orphans: 2; widows: 2;"><span style="font-size: 14px;">FROM sys.dm_os_buffer_descriptors AS bd&nbsp;</span></p><p style="font-size: 16px; white-space: normal; orphans: 2; widows: 2;"><span style="font-size: 14px;">&nbsp; &nbsp; INNER JOIN&nbsp;</span></p><p style="font-size: 16px; white-space: normal; orphans: 2; widows: 2;"><span style="font-size: 14px;">&nbsp; &nbsp; (</span></p><p style="font-size: 16px; white-space: normal; orphans: 2; widows: 2;"><span style="font-size: 14px;">&nbsp; &nbsp; &nbsp; &nbsp; SELECT OBJECT_NAME(OBJECT_ID) AS name&nbsp;</span></p><p style="font-size: 16px; white-space: normal; orphans: 2; widows: 2;"><span style="font-size: 14px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ,index_id ,allocation_unit_id</span></p><p style="font-size: 16px; white-space: normal; orphans: 2; widows: 2;"><span style="font-size: 14px;">&nbsp; &nbsp; &nbsp; &nbsp; FROM sys.allocation_units AS au</span></p><p style="font-size: 16px; white-space: normal; orphans: 2; widows: 2;"><span style="font-size: 14px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; INNER JOIN sys.partitions AS p&nbsp;</span></p><p style="font-size: 16px; white-space: normal; orphans: 2; widows: 2;"><span style="font-size: 14px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ON au.container_id = p.hobt_id&nbsp;</span></p><p style="font-size: 16px; white-space: normal; orphans: 2; widows: 2;"><span style="font-size: 14px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND (au.type = 1 OR au.type = 3)</span></p><p style="font-size: 16px; white-space: normal; orphans: 2; widows: 2;"><span style="font-size: 14px;">&nbsp; &nbsp; &nbsp; &nbsp; UNION ALL</span></p><p style="font-size: 16px; white-space: normal; orphans: 2; widows: 2;"><span style="font-size: 14px;">&nbsp; &nbsp; &nbsp; &nbsp; SELECT OBJECT_NAME(OBJECT_ID) AS name &nbsp;&nbsp;</span></p><p style="font-size: 16px; white-space: normal; orphans: 2; widows: 2;"><span style="font-size: 14px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ,index_id, allocation_unit_id</span></p><p style="font-size: 16px; white-space: normal; orphans: 2; widows: 2;"><span style="font-size: 14px;">&nbsp; &nbsp; &nbsp; &nbsp; FROM sys.allocation_units AS au</span></p><p style="font-size: 16px; white-space: normal; orphans: 2; widows: 2;"><span style="font-size: 14px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; INNER JOIN sys.partitions AS p&nbsp;</span></p><p style="font-size: 16px; white-space: normal; orphans: 2; widows: 2;"><span style="font-size: 14px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ON au.container_id = p.partition_id&nbsp;</span></p><p style="font-size: 16px; white-space: normal; orphans: 2; widows: 2;"><span style="font-size: 14px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND au.type = 2</span></p><p style="font-size: 16px; white-space: normal; orphans: 2; widows: 2;"><span style="font-size: 14px;">&nbsp; &nbsp; ) AS obj&nbsp;</span></p><p style="font-size: 16px; white-space: normal; orphans: 2; widows: 2;"><span style="font-size: 14px;">&nbsp; &nbsp; &nbsp; &nbsp; ON bd.allocation_unit_id = obj.allocation_unit_id</span></p><p style="font-size: 16px; white-space: normal; orphans: 2; widows: 2;"><span style="font-size: 14px;">WHERE database_id = DB_ID()</span></p><p style="font-size: 16px; white-space: normal; orphans: 2; widows: 2;"><span style="font-size: 14px;">GROUP BY name, index_id&nbsp;</span></p><p style="font-size: 16px; white-space: normal; orphans: 2; widows: 2;"><span style="font-size: 14px;">ORDER BY CachedMemoryMB DESC;</span></p>