<p>--=========================================</p><p>--检查各数据库日志的使用情况&nbsp;</p><p>-- Recovery model, log reuse wait description, log file size,</p><p>-- log usage size and compatibility level for all databases on instance</p><p>SELECT</p><p>db.[name] AS [Database Name] ,</p><p>db.recovery_model_desc AS [Recovery Model] ,</p><p>db.log_reuse_wait_desc AS [Log Reuse Wait Description] ,</p><p>ls.cntr_value AS [Log Size (KB)] ,</p><p>lu.cntr_value AS [Log Used (KB)] ,</p><p>CAST(CAST(lu.cntr_value AS FLOAT)</p><p>&nbsp; &nbsp;/ CAST(ls.cntr_value+1 AS FLOAT) AS DECIMAL(18,2))</p><p>&nbsp; &nbsp;* 100 AS [Log Used %] ,</p><p>db.[compatibility_level] AS [DB Compatibility Level] ,</p><p>db.page_verify_option_desc AS [Page Verify Option]</p><p>FROM sys.databases AS db</p><p>INNER JOIN sys.dm_os_performance_counters AS lu</p><p>ON db.name = lu.instance_name</p><p>INNER JOIN sys.dm_os_performance_counters AS ls</p><p>ON db.name = ls.instance_name</p><p>WHERE lu.counter_name LIKE &#39;Log File(s) Used Size (KB)%&#39;</p><p>AND ls.counter_name LIKE &#39;Log File(s) Size (KB)%&#39; ;</p><p><br/></p>