<p>USE [master]</p><p>GO</p><p><br/></p><p>/****** Object: &nbsp;StoredProcedure [dbo].[Sp_KillAllProcessInDB] &nbsp; &nbsp;Script Date: 02/07/2014 12:04:29 ******/</p><p>SET ANSI_NULLS ON</p><p>GO</p><p><br/></p><p>SET QUOTED_IDENTIFIER ON</p><p>GO</p><p>CREATE PROC [dbo].[usp_KillAllProcessInDB]&nbsp;</p><p>@DbName VARCHAR(100)</p><p>AS</p><p>BEGIN</p><p>&nbsp; &nbsp; IF DB_ID(@DbName) = NULL&nbsp;</p><p>&nbsp; &nbsp; BEGIN</p><p>&nbsp; &nbsp; &nbsp; &nbsp; PRINT &#39;DataBase dose not Exist&#39;;</p><p>&nbsp; &nbsp; END</p><p>&nbsp; &nbsp; ELSE</p><p>&nbsp; &nbsp; BEGIN</p><p>&nbsp; &nbsp; &nbsp; &nbsp; DECLARE @spId VARCHAR(30);</p><p>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; DECLARE TmpCursor CURSOR FOR</p><p>&nbsp; &nbsp; &nbsp; &nbsp; SELECT &#39;Kill &#39; + CONVERT(VARCHAR, SPID) AS SPID</p><p>&nbsp; &nbsp; &nbsp; &nbsp; FROM master..SysProcesses</p><p>&nbsp; &nbsp; &nbsp; &nbsp; WHERE DB_NAME(dbID) = @DbName</p><p>&nbsp; &nbsp; &nbsp; &nbsp; AND SPID &lt;&gt; @@SPID</p><p>&nbsp; &nbsp; &nbsp; &nbsp; AND dbID &lt;&gt; 0;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; OPEN TmpCursor;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; FETCH NEXT FROM TmpCursor</p><p>&nbsp; &nbsp; &nbsp; &nbsp; INTO @spId;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; WHILE @@FETCH_STATUS = 0</p><p>&nbsp; &nbsp; &nbsp; &nbsp; BEGIN</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; EXEC (@spId)</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FETCH NEXT FROM TmpCursor</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; INTO @spId&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; END</p><p>&nbsp; &nbsp; &nbsp; &nbsp; CLOSE TmpCursor;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; DEALLOCATE TmpCursor;</p><p>&nbsp; &nbsp; END&nbsp;</p><p>END</p><p>GO</p><p><br/></p>