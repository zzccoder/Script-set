<p></p><p>use master</p><p>GO</p><p>SELECT name,is_master_key_encrypted_by_server FROM sys.databases;</p><p>&nbsp;</p><p>--查看master数据库下的密钥信息</p><p>SELECT * FROM sys.symmetric_keys;</p><p>&nbsp;</p><p>--创建证书用来保护数据库加密密钥(DEK)</p><p>CREATE CERTIFICATE DB_TDE_cert</p><p>WITH SUBJECT = N&#39;DB_TDE_cert&#39;;</p><p>&nbsp;</p><p>--备份证书</p><p>BACKUP CERTIFICATE DB_TDE_cert</p><p>TO FILE = &#39;D:\DB_TDE_cert.cer&#39;</p><p>WITH PRIVATE KEY (</p><p>FILE = &#39;D:\DB_TDE_cert.pvk&#39; ,</p><p>ENCRYPTION BY PASSWORD = &#39;Tde@sql123&#39; );</p><p>&nbsp;</p><p>---创建测试DB</p><p>IF(DB_ID(&#39;TestDB&#39;) IS NOT NULL)</p><p>BEGIN</p><p>&nbsp; &nbsp;DROP DATABASE TestDB</p><p>END</p><p>GO</p><p>CREATE DATABASE TestDB</p><p>GO</p><p>&nbsp;</p><p>USE TestDB;</p><p>GO</p><p>--创建由master_server_cert保护的DEK 数据库加密密钥（对称密钥）</p><p>CREATE DATABASE ENCRYPTION KEY</p><p>WITH ALGORITHM = AES_128</p><p>ENCRYPTION BY SERVER CERTIFICATE DB_TDE_cert;</p><p>GO</p><p>--将数据库改成单用户模式</p><p>use master</p><p>GO</p><p>ALTER DATABASE TestDB SET SINGLE_USER WITH ROLLBACK IMMEDIATE;</p><p>GO</p><p>--开始数据加密</p><p>ALTER DATABASE TestDB SET ENCRYPTION ON;</p><p>GO</p><p>--将数据库设置为多用户模式</p><p>ALTER DATABASE TestDB SET MULTI_USER WITH ROLLBACK IMMEDIATE;</p><p>GO</p><p>&nbsp;</p><p>--查看数据库加密模式</p><p>SELECT DB_NAME(database_id),encryption_state</p><p>FROM sys.dm_database_encryption_keys;</p>