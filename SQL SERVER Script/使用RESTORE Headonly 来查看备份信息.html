<p></p><p>--使用RESTORE Headonly 来查看备份信息</p><p>DECLARE @command NVARCHAR( 1000)</p><p>DECLARE @backup_header TABLE</p><p>(</p><p>BackupName&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NVARCHAR( 128)&nbsp; NULL,</p><p>BackupDescription&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NVARCHAR (256)&nbsp;&nbsp; NULL,</p><p>BackupType&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INT,&nbsp;&nbsp;</p><p>ExpirationDate&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DATETIME NULL,</p><p>Compressed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INT,&nbsp;</p><p>POSITION&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INT,&nbsp;</p><p>DeviceType&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INT,&nbsp;</p><p>UserName&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NVARCHAR( 128) NULL,</p><p>SERVERNAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NVARCHAR( 128),</p><p>DatabaseName&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NVARCHAR( 128),</p><p>DatabaseVersion&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INT,&nbsp;</p><p>DatabaseCreationDate&nbsp;&nbsp;&nbsp; DATETIME,&nbsp;</p><p>BackupSize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NUMERIC( 20,0 ) NULL,&nbsp;</p><p>FirstLsn&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NUMERIC( 25,0 ) NULL,&nbsp;</p><p>LastLsn&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NUMERIC(25 ,0) NULL,</p><p>CheckpointLsn&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NUMERIC( 25,0 ) NULL,&nbsp;</p><p>DatabaseBackupLsn&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NUMERIC (25, 0) NULL,</p><p>BackupStartDate&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DATETIME,&nbsp;</p><p>BackupFinishDate&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DATETIME,&nbsp;</p><p>SortOrder&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INT,&nbsp;</p><p>CodePage&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INT,&nbsp;</p><p>UnicodeLocaleId&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INT,&nbsp;</p><p>UnicodeComparisonStyle INT,&nbsp;</p><p>CompatibilityLevel&nbsp;&nbsp;&nbsp;&nbsp; INT ,</p><p>SoftwareVendorId&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INT,&nbsp;</p><p>SoftwareVersionMajor&nbsp;&nbsp;&nbsp; INT,&nbsp;</p><p>SoftwareVersionMinor&nbsp;&nbsp;&nbsp; INT,&nbsp;</p><p>SoftwareVersionBuild&nbsp;&nbsp;&nbsp; INT,&nbsp;</p><p>MachineName&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NVARCHAR( 128),</p><p>Flags&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INT NULL,&nbsp;</p><p>BindingId&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; UNIQUEIDENTIFIER NULL,</p><p>RecoveryForkId&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; UNIQUEIDENTIFIER NULL,</p><p>COLLATION&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NVARCHAR( 128) NULL,</p><p>FamilyGUID UNIQUEIDENTIFIER NULL,</p><p>HasBulkLoggedData BIT NULL,</p><p>IsSnapshot BIT NULL,</p><p>IsReadOnly BIT NULL,</p><p>IsSingleUser BIT NULL,</p><p>HasBackupChecksums BIT NULL,</p><p>IsDamaged BIT NULL,</p><p>BeginsLogChain BIT NULL,</p><p>HasIncompleteMetadata BIT NULL,</p><p>IsForceOffline BIT NULL,</p><p>IsCopyOnly BIT NULL,</p><p>FirstRecoveryForkID UNIQUEIDENTIFIER NULL,</p><p>ForkPointLSN NUMERIC (25, 0) NULL,</p><p>RecoveryModel NVARCHAR (60) NULL,</p><p>DifferentialBaseLSN NUMERIC( 25,0 ) NULL,&nbsp;</p><p>DifferentialBaseGUID UNIQUEIDENTIFIER NULL,</p><p>BackupTypeDescription NVARCHAR( 60) NULL,</p><p>BackupSetGUID UNIQUEIDENTIFIER NULL,</p><p>CompressedBackupSize NUMERIC( 20,0 ) NULL</p><p>)</p><p>DECLARE @backup_file_name NVARCHAR( 500)</p><p>SET @backup_file_name =&#39;&#39;</p><p>SELECT @command = N&#39;restore headeronly from disk = N&#39;&#39;&#39;</p><p>+ REPLACE (@backup_file_name, N&#39;&#39;&#39;&#39;, N&#39;&#39;&#39;&#39;&#39;&#39;) + N&#39;&#39;&#39;&#39;&nbsp;&nbsp;</p><p>INSERT INTO @backup_header</p><p>EXECUTE(@command )</p><p>SELECT *</p><p>FROM @backup_file_name</p>