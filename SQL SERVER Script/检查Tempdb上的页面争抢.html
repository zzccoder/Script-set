<p>--=============================================</p><p>--检查Tempdb上的页面争抢</p><p>--http://www.sqlsoldier.com/wp/sqlserver/breakingdowntempdbcontentionpart2</p><p>With Tasks</p><p>As (Select session_id,</p><p>&nbsp; &nbsp; &nbsp; &nbsp; wait_type,</p><p>&nbsp; &nbsp; &nbsp; &nbsp; wait_duration_ms,</p><p>&nbsp; &nbsp; &nbsp; &nbsp; blocking_session_id,</p><p>&nbsp; &nbsp; &nbsp; &nbsp; resource_description,</p><p>&nbsp; &nbsp; &nbsp; &nbsp; PageID = Cast(Right(resource_description, Len(resource_description)</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - Charindex(&#39;:&#39;, resource_description, 3)) As Int)</p><p>&nbsp; &nbsp; From sys.dm_os_waiting_tasks</p><p>&nbsp; &nbsp; Where wait_type Like &#39;PAGE%LATCH_%&#39;</p><p>&nbsp; &nbsp; And resource_description Like &#39;2:%&#39;)</p><p>Select session_id,</p><p>&nbsp; &nbsp; &nbsp; &nbsp; wait_type,</p><p>&nbsp; &nbsp; &nbsp; &nbsp; wait_duration_ms,</p><p>&nbsp; &nbsp; &nbsp; &nbsp; blocking_session_id,</p><p>&nbsp; &nbsp; &nbsp; &nbsp; resource_description,</p><p>&nbsp; &nbsp; ResourceType = Case</p><p>&nbsp; &nbsp; &nbsp; &nbsp; When PageID = 1 Or PageID % 8088 = 0 Then &#39;Is PFS Page&#39;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; When PageID = 2 Or PageID % 511232 = 0 Then &#39;Is GAM Page&#39;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; When PageID = 3 Or (PageID - 1) % 511232 = 0 Then &#39;Is SGAM Page&#39;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; Else &#39;Is Not PFS, GAM, or SGAM page&#39;</p><p>&nbsp; &nbsp; End</p><p>From Tasks;</p><p><br/></p><p>--================================================</p><p>若大量出现FPS，GAM，SGAM堵塞，一般是2:1:1，2:1:2，2:1:3（fps间隔8088个页，GAM/SGAM间隔 7988*8页，页可以使用dbcc page 查看pagetype确定是否是GAM/SGAM/FPS）。</p><p>若出现冲突解决方法：<br/>1.减少临时表的使用<br/>2.开启1118，使用专有区来存放<br/>3.创建多个数据文件，将分配页平均转移到各个文件上</p><p>推荐做法（宋沄剑如是说）：<br/>对tempdb按照每次4个的方式增加，然后查看是否依然存在瓶颈，存在则继续增加</p>