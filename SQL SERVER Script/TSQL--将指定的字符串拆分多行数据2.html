<p></p><p>--===============================================================</p><p>--拆分脚本</p><p>CREATE FUNCTION [dbo].[SplitString]</p><p>( &nbsp; &nbsp;</p><p>&nbsp; @Input NVARCHAR(MAX), --input string to be separated &nbsp; &nbsp;</p><p>&nbsp; @Separator NVARCHAR(MAX)=&#39;,&#39;, --a string that delimit the substrings in the input string &nbsp; &nbsp;</p><p>&nbsp; @RemoveEmptyEntries BIT=1 --the return value does not include array elements that contain an empty string</p><p>)</p><p>RETURNS @TABLE TABLE&nbsp;</p><p>( &nbsp; &nbsp;</p><p>&nbsp; [Id] INT IDENTITY(1,1), &nbsp; &nbsp;</p><p>&nbsp; [VALUE] NVARCHAR(MAX))&nbsp;</p><p>AS</p><p>BEGIN &nbsp; &nbsp;&nbsp;</p><p>&nbsp; DECLARE @Index INT, @Entry NVARCHAR(MAX) &nbsp; &nbsp;</p><p>&nbsp; SET @Index = CHARINDEX(@Separator,@Input) &nbsp; &nbsp;</p><p><br/></p><p>&nbsp; WHILE (@Index&gt;0) &nbsp; &nbsp;</p><p>&nbsp; BEGIN &nbsp; &nbsp; &nbsp; &nbsp;</p><p>&nbsp; &nbsp; SET @Entry=LTRIM(RTRIM(SUBSTRING(@Input, 1, @Index-1))) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; IF (@RemoveEmptyEntries=0) OR (@RemoveEmptyEntries=1 AND @Entry&lt;&gt;&#39;&#39;) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; BEGIN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; INSERT INTO @TABLE([VALUE]) VALUES(@Entry) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; END &nbsp; &nbsp; &nbsp; &nbsp;</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; SET @Input = SUBSTRING(@Input, @Index+DATALENGTH(@Separator)/2, LEN(@Input)) &nbsp; &nbsp; &nbsp; &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; SET @Index = CHARINDEX(@Separator, @Input) &nbsp; &nbsp;</p><p>&nbsp; END &nbsp; &nbsp; &nbsp; &nbsp;</p><p><br/></p><p>&nbsp; SET @Entry=LTRIM(RTRIM(@Input)) &nbsp; &nbsp;</p><p>&nbsp; IF (@RemoveEmptyEntries=0) OR (@RemoveEmptyEntries=1 AND @Entry&lt;&gt;&#39;&#39;) &nbsp; &nbsp; &nbsp; &nbsp;</p><p>&nbsp; &nbsp; BEGIN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>&nbsp; &nbsp; &nbsp; INSERT INTO @TABLE([VALUE]) VALUES(@Entry) &nbsp; &nbsp; &nbsp; &nbsp;</p><p>&nbsp; &nbsp; END &nbsp; &nbsp;</p><p>RETURN</p><p><br/></p><p>END&nbsp;</p><p>GO</p><p>--===============================================================</p><p>--测试脚本</p><p><br/></p><p>DECLARE @str1 VARCHAR(MAX), @str2 VARCHAR(MAX), @str3 VARCHAR(MAX)</p><p><br/></p><p>SET @str1 = &#39;1,2,3&#39;</p><p>SET @str2 = &#39;1###2###3&#39;</p><p>SET @str3 = &#39;1###2###3###&#39;</p><p><br/></p><p>SELECT [VALUE] FROM [dbo].[SplitString](@str1, &#39;,&#39;, 1)</p><p>SELECT [VALUE] FROM [dbo].[SplitString](@str2, &#39;###&#39;, 1)</p><p>SELECT [VALUE] FROM [dbo].[SplitString](@str3, &#39;###&#39;, 0)</p>