<p></p><p>--============================================== &nbsp;</p><p>-- &nbsp;FUNCTION &nbsp;hexstr2varbin &nbsp;</p><p>-- &nbsp;将 varchar 类型的数据转换为 varbinary 类型&nbsp;</p><p>-- 来自http://guangrou.blog.51cto.com/404164/1040606</p><p>--============================================== &nbsp;</p><p>&nbsp;</p><p>IF OBJECT_ID (&#39;dbo.hexstr2varbin&#39;) IS NOT NULL&nbsp;</p><p>&nbsp; &nbsp;DROP FUNCTION dbo.hexstr2varbin &nbsp;</p><p>GO &nbsp;</p><p>CREATE FUNCTION [dbo].[hexstr2varbin]( &nbsp;</p><p>&nbsp;@char VARCHAR(8000) &nbsp;</p><p>)RETURNS VARBINARY(8000) &nbsp;</p><p>AS&nbsp;</p><p>BEGIN&nbsp;</p><p>DECLARE @re VARBINARY(8000), @tempchar VARCHAR(2), &nbsp;&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @getchar VARCHAR(1), @getint INT, @n INT, @totalint INT, &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @i INT, @tempint INT, @runNum INT -- 字符串截取段数 &nbsp;</p><p><br/></p><p>&nbsp; SELECT @tempchar=&#39;&#39;,@i=DATALENGTH(@char), @re=0x; &nbsp;&nbsp;</p><p><br/></p><p>&nbsp; IF( @i&gt;0) &nbsp;</p><p>&nbsp; BEGIN&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;IF ( @i%2 = 0) SET @runNum= @i/2 &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;ELSE SET @runNum= @i/2 + 1 &nbsp;&nbsp;</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; WHILE (@runNum &gt; 0) &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;BEGIN&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;IF(@runNum = 1) SET @tempchar = @char &nbsp;&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ELSE SET @tempchar = SUBSTRING(@char, (@runNum-1)*2,2) &nbsp;</p><p><br/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SELECT @n=1,@totalint=0; &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-- 循环处理截取的每个字符串 (这里的字符串长度为2) &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;WHILE @n &lt; ( DATALENGTH(@tempchar) + 1 ) &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;BEGIN&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SET @getchar=SUBSTRING(@tempchar,@n,1); &nbsp;</p><p>&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -- 将字符转换为十六进制对应的数字 &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SELECT @getint=CASE &nbsp; &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WHEN @getchar=&#39;a&#39; THEN 10 &nbsp;&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WHEN @getchar=&#39;b&#39; THEN 11 &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WHEN @getchar=&#39;c&#39; THEN 12 &nbsp;&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WHEN @getchar=&#39;d&#39; THEN 13 &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;WHEN @getchar=&#39;e&#39; THEN 14 &nbsp;&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;WHEN @getchar=&#39;f&#39; THEN 15 &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ELSE &nbsp;CONVERT(INT,@getchar) END; &nbsp;</p><p>&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SET @tempint=@getint*POWER(16,DATALENGTH(@tempchar)-@n) &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SET @totalint = @totalint + @tempint &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SET @n=@n+1 &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;END &nbsp;&nbsp;</p><p>&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SET @re=CONVERT(VARBINARY(1),@totalint) + @re; &nbsp; &nbsp; &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SET @runNum=@runNum-1; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; END&nbsp;</p><p>&nbsp; &nbsp;END&nbsp;</p><p>&nbsp; RETURN @re &nbsp;</p><p><br/></p><p>END&nbsp;</p><p>GO&nbsp;</p>