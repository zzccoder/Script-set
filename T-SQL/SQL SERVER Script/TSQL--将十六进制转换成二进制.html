<p>--====================================================</p><p>--将十六进制转换成二进制</p><p>CREATE FUNCTION dbo.HexStrToVarBin(@hexstr VARCHAR(8000)) &nbsp;</p><p>RETURNS varbinary(8000) &nbsp;</p><p>AS &nbsp;</p><p>BEGIN &nbsp;</p><p>&nbsp; &nbsp;DECLARE @hex CHAR(2), @i INT, @count INT, @b varbinary(8000), @odd BIT, @start bit&nbsp;</p><p>&nbsp; &nbsp;SET @count = LEN(@hexstr) &nbsp;</p><p>&nbsp; &nbsp;SET @start = 1&nbsp;</p><p>&nbsp; &nbsp;SET @b = CAST(&#39;&#39; AS varbinary(1)) &nbsp;</p><p>&nbsp; &nbsp;IF SUBSTRING(@hexstr, 1, 2) = &#39;0x&#39; &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;SET @i = 3 &nbsp;</p><p>&nbsp; &nbsp;ELSE &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;SET @i = 1 &nbsp;</p><p>&nbsp; &nbsp;SET @odd = CAST(LEN(SUBSTRING(@hexstr, @i, LEN(@hexstr))) % 2 AS BIT)&nbsp;</p><p>&nbsp; &nbsp;WHILE (@i &lt;= @count) &nbsp;</p><p>&nbsp; &nbsp; BEGIN&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;IF @start = 1 AND @odd = 1&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;BEGIN</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SET @hex = &#39;0&#39; + SUBSTRING(@hexstr, @i, 1)&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;END</p><p>&nbsp; &nbsp; &nbsp; &nbsp;ELSE&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;BEGIN&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SET @hex = SUBSTRING(@hexstr, @i, 2)&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;END&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;SET @b = @b + &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CAST(CASE WHEN SUBSTRING(@hex, 1, 1) LIKE &#39;[0-9]&#39; &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;THEN CAST(SUBSTRING(@hex, 1, 1) AS INT) &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ELSE CAST(ASCII(UPPER(SUBSTRING(@hex, 1, 1)))-55 AS INT) &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;END * 16 + &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CASE WHEN SUBSTRING(@hex, 2, 1) LIKE &#39;[0-9]&#39; &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;THEN CAST(SUBSTRING(@hex, 2, 1) AS INT) &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ELSE CAST(ASCII(UPPER(SUBSTRING(@hex, 2, 1)))-55 AS INT) &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;END AS binary(1)) &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;SET @i = @i + (2 - (CAST(@start AS INT) * CAST(@odd AS INT)))&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;IF @start = 1&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;BEGIN&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SET @start = 0&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;END&nbsp;</p><p>&nbsp; &nbsp; END &nbsp;</p><p>&nbsp; &nbsp; RETURN @b &nbsp;</p><p>END &nbsp;</p><p>GO</p><p><br/></p>