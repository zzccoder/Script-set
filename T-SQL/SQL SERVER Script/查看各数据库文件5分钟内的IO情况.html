<p></p><p>--==================================</p><p>--查看各数据库文件5分钟内的IO情况</p><p><br/></p><p>--查看5分钟内文件的IO情况</p><p>IF(OBJECT_ID(&#39;tempdb.dbo.#TB1&#39;) IS NOT NULL)</p><p>BEGIN</p><p>DROP TABLE #TB1</p><p>END</p><p>IF(OBJECT_ID(&#39;tempdb.dbo.#TB2&#39;) IS NOT NULL)</p><p>BEGIN</p><p>DROP TABLE TB2</p><p>END</p><p>SELECT&nbsp;</p><p>database_id,</p><p>file_id,</p><p>io_stall_read_ms,&nbsp;</p><p>io_stall_write_ms,</p><p>num_of_reads,</p><p>num_of_writes,</p><p>num_of_bytes_read,</p><p>num_of_bytes_written</p><p>INTO #TB1</p><p>FROM sys.dm_io_virtual_file_stats(NULL,NULL)</p><p>WAITFOR DELAY &#39;0:05:00&#39;</p><p>SELECT&nbsp;</p><p>database_id,</p><p>file_id,</p><p>io_stall_read_ms,&nbsp;</p><p>io_stall_write_ms,</p><p>num_of_reads,</p><p>num_of_writes,</p><p>num_of_bytes_read,</p><p>num_of_bytes_written</p><p>INTO #TB2</p><p>FROM sys.dm_io_virtual_file_stats(NULL,NULL)</p><p>SELECT&nbsp;</p><p>T1.database_id,</p><p>DB_NAME(T1.database_id) AS database_name,</p><p>T1.file_id,</p><p>T2.io_stall_read_ms-T1.io_stall_read_ms AS io_stall_read_ms,&nbsp;</p><p>T2.io_stall_write_ms-T1.io_stall_write_ms AS io_stall_write_ms,</p><p>T2.num_of_reads-T1.num_of_reads AS num_of_reads,</p><p>T2.num_of_writes-T1.num_of_writes AS num_of_writes ,</p><p>T2.num_of_bytes_read-T1.num_of_bytes_read AS num_of_bytes_read,</p><p>T2.num_of_bytes_written-T1.num_of_bytes_written AS num_of_bytes_written</p><p>FROM #TB1 AS T1</p><p>INNER JOIN #TB2 AS T2</p><p>ON T1.database_id=T2.database_id</p><p>AND T1.file_id=T2.file_id</p>