<p>use test_shrink&nbsp;</p><p>go&nbsp;</p><p>drop table extentinfo</p><p>go</p><p>create table extentinfo&nbsp;</p><p>( [file_id] smallint,&nbsp;</p><p>page_id int,&nbsp;</p><p>pg_alloc int,&nbsp;</p><p>ext_size int,&nbsp;</p><p>obj_id int,&nbsp;</p><p>index_id int,&nbsp;</p><p>partition_number int,</p><p>partition_id bigint,</p><p>iam_chain_type varchar(50),</p><p>pfs_bytes varbinary(10) )&nbsp;</p><p>go&nbsp;</p><p>drop proc import_extentinfo</p><p>go</p><p>create procedure import_extentinfo&nbsp;</p><p>as dbcc extentinfo(&#39;test_shrink&#39;)&nbsp;</p><p>go&nbsp;</p><p>insert extentinfo&nbsp;</p><p>exec import_extentinfo&nbsp;</p><p>go&nbsp;</p><p>select [file_id],obj_id, index_id, partition_id, ext_size,&nbsp;</p><p>&#39;actual extent count&#39;=count(*), &#39;actual page count&#39;=sum(pg_alloc),&nbsp;</p><p>&#39;possible extent count&#39;=ceiling(sum(pg_alloc)*1.0/ext_size),&nbsp;</p><p>&#39;possible extents / actual extents&#39; = (ceiling(sum(pg_alloc)*1.00/ext_size)*100.00) / count(*)&nbsp;</p><p>from extentinfo&nbsp;</p><p>group by [file_id],obj_id, index_id,partition_id, ext_size&nbsp;</p><p>having count(*)-ceiling(sum(pg_alloc)*1.0/ext_size) &gt; 0&nbsp;</p><p>order by partition_id, obj_id, index_id, [file_id]</p><p><br/></p>