<p><span style="font-size: 18px;">--在数据库升级时，为防止升级失败造成的影响，我们通常需要：</span></p><p><span style="font-family: 微软雅黑, sans-serif; font-size: 18px;">--1.准备回滚脚本，用于失败后回滚</span><br/></p><p><span style="font-family: 微软雅黑, sans-serif; font-size: 18px;">--2.在升级前备份数据库，用于失败后恢复</span><br/></p><p><span style="font-family: 微软雅黑, sans-serif; font-size: 18px;">--但回滚脚本需要花费很长时间准备，而备份恢复会导致数据库长时间不可用，为解决此类问题，可以使用数据库快照，数据库快照生成速度和还原速度都远快于备份，且操作简单。</span><br/></p><p><br/></p><p>--==========================================================</p><p>--创建数据库快照</p><p>CREATE &nbsp;DATABASE BackupTestDB_SNAP ON (NAME=&#39;BackupTestDB&#39;,</p><p>FILENAME=&#39;D:\DB\BackupTestDB.snap&#39;)</p><p>,(NAME=&#39;BackupTestDB_F1&#39;,FILENAME=&#39;D:\DB\BackupTestDB_F1.snap&#39;)</p><p>AS SNAPSHOT OF BackupTestDB;</p><p>GO</p><p>--==========================================================</p><p>--在源数据库中增加表TB4</p><p>USE BackupTestDB</p><p>GO</p><p>SELECT 1 AS ID INTO TB4</p><p>--==========================================================</p><p>--使用快照还原数据库BackupTestDB</p><p>--还原结束后发现表TB4已不存在</p><p>USE master</p><p>GO</p><p>RESTORE DATABASE BackupTestDB</p><p>FROM DATABASE_SNAPSHOT=&#39;BackupTestDB_SNAP&#39;</p><p><br/></p>