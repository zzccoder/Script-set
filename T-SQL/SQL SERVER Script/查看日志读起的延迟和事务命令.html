<p></p><p>--========================================================================</p><p>--MSlogreader_history 表存放本地分发服务器关联的日志读取器代理的历史记录</p><p>--time:记录消息的时间。&nbsp;</p><p>--delivery_latency:命令从进入发布数据库到进入分发数据库之间的滞后时间。&nbsp;</p><p>--delivered_transactions:会话中传递的事务总数。&nbsp;</p><p>--delivered_commands:会话中传递的命令总数。&nbsp;</p><p>--average_commands:会话中传递的平均命令数。</p><p>WITH &nbsp; &nbsp;T AS ( SELECT &nbsp; ROW_NUMBER() OVER ( PARTITION BY agent_id ORDER BY time ASC ) AS RID ,</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [agent_id] ,</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [delivered_transactions] ,</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [delivered_commands] ,</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [average_commands] ,</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [delivery_latency] ,</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [time]</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FROM &nbsp; &nbsp; distribution.dbo.MSlogreader_history</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)</p><p>&nbsp; &nbsp; SELECT &nbsp;T1.[agent_id] ,</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; T1.[time] ,</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ( CAST(T1.[delivered_transactions] AS BIGINT)</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - T2.[delivered_transactions] ) AS Transcations ,</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ( CAST(T1.[delivered_commands] AS BIGINT)</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - T2.[delivered_commands] ) AS Commands ,</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; T1.[delivery_latency]</p><p>&nbsp; &nbsp; FROM &nbsp; &nbsp;T AS T1</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; INNER JOIN T AS T2 ON T1.agent_id = T2.agent_id</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND T1.RID = T2.RID + 1</p><p><br/></p>