<p></p><p>--查看超过30秒等待的查询</p><p><br/></p><p>SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED&nbsp;</p><p>SELECT&nbsp;</p><p>Waits.wait_duration_ms / 1000 AS WaitInSeconds&nbsp;</p><p>, Blocking.session_id as BlockingSessionId&nbsp;</p><p>, Sess.login_name AS BlockingUser&nbsp;</p><p>, Sess.host_name AS BlockingLocation&nbsp;</p><p>, BlockingSQL.text AS BlockingSQL&nbsp;</p><p>, Blocked.session_id AS BlockedSessionId&nbsp;</p><p>, BlockedSess.login_name AS BlockedUser&nbsp;</p><p>, BlockedSess.host_name AS BlockedLocation&nbsp;</p><p>, BlockedSQL.text AS BlockedSQL&nbsp;</p><p>, DB_NAME(Blocked.database_id) AS DatabaseName&nbsp;</p><p>FROM sys.dm_exec_connections AS Blocking &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>INNER JOIN sys.dm_exec_requests AS Blocked&nbsp;</p><p>ON Blocking.session_id = Blocked.blocking_session_id&nbsp;</p><p>INNER JOIN sys.dm_exec_sessions Sess&nbsp;</p><p>ON Blocking.session_id = sess.session_id &nbsp;</p><p>INNER JOIN sys.dm_tran_session_transactions st&nbsp;</p><p>ON Blocking.session_id = st.session_id&nbsp;</p><p>LEFT OUTER JOIN sys.dm_exec_requests er&nbsp;</p><p>ON st.session_id = er.session_id&nbsp;</p><p>AND er.session_id IS NULL&nbsp;</p><p>INNER JOIN sys.dm_os_waiting_tasks AS Waits&nbsp;</p><p>ON Blocked.session_id = Waits.session_id&nbsp;</p><p>CROSS APPLY sys.dm_exec_sql_text(Blocking.most_recent_sql_handle) AS BlockingSQL&nbsp;</p><p>INNER JOIN sys.dm_exec_requests AS BlockedReq &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>ON Waits.session_id = BlockedReq.session_id&nbsp;</p><p>INNER JOIN sys.dm_exec_sessions AS BlockedSess&nbsp;</p><p>ON Waits.session_id = BlockedSess.session_id&nbsp;</p><p>CROSS APPLY sys.dm_exec_sql_text(Blocked.sql_handle) AS BlockedSQL&nbsp;</p><p>WHERE Waits.wait_duration_ms &gt; 30000&nbsp;</p><p>ORDER BY WaitInSeconds</p>