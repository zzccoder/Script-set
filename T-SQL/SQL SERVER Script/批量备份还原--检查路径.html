<p></p><p>Use master</p><p>GO</p><p>/*=================Check Restore Path Drives Exists==========================</p><p>&nbsp; =====Ken.Guo &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ======</p><p>&nbsp; =====2010.9.10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;======</p><p>&nbsp; =====EXEC Usp_Check_DriveExists @RestoreDataPath,@ResultCount OUTPUT ======</p><p>&nbsp; ===========================================================================</p><p>*/</p><p>CREATE PROC Usp_Check_DriveExists(</p><p>&nbsp; &nbsp; &nbsp; @RestoreDataPath nvarchar(200)</p><p>&nbsp; &nbsp; &nbsp;,@ResultCount int OUTPUT)&nbsp;</p><p>AS</p><p>BEGIN</p><p>--Check Restore Path and Size &gt;1000M</p><p>if CHARINDEX(&#39;:&#39;,@RestoreDataPath)&gt;0</p><p>&nbsp; begin</p><p>&nbsp; &nbsp; DECLARE @Drive nvarchar(10)</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;,@errorinfo nvarchar(500)</p><p><br/></p><p>&nbsp; &nbsp; DECLARE @DriveList TABLE&nbsp;</p><p>&nbsp; &nbsp; ( &nbsp; &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Drive nvarchar(10)&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; ,DSize bigint&nbsp;</p><p>&nbsp; &nbsp; )</p><p>&nbsp; &nbsp; INSERT INTO @DriveList</p><p>&nbsp; &nbsp; &nbsp;EXEC master.dbo.xp_fixeddrives</p><p><br/></p><p>&nbsp; &nbsp; SET @Drive=Left(@RestoreDataPath,CHARINDEX(&#39;:&#39;,@RestoreDataPath)-1)</p><p>&nbsp; &nbsp; if not exists(SELECT&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FROM &nbsp;@DriveList&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WHERE&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Drive=@Drive&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND DSize&gt;1024</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)</p><p>&nbsp; &nbsp; &nbsp; begin</p><p>&nbsp; &nbsp; &nbsp; &nbsp;set @errorinfo=N&#39;找不到还原磁盘:&#39;+@Drive+N&#39; ，或者磁盘剩余空间小于1G&#39;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;RAISERROR 50001 @errorinfo&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;set @ResultCount=0</p><p>&nbsp; &nbsp; &nbsp; &nbsp;return</p><p>&nbsp; &nbsp; &nbsp; end</p><p>&nbsp; end</p><p>else if(LEN(@RestoreDataPath)&gt;1) AND CHARINDEX(&#39;:&#39;,@RestoreDataPath)=0</p><p>&nbsp; begin</p><p>&nbsp; &nbsp; set @errorinfo=N&#39;还原路径错误:&#39;+@RestoreDataPath+N&#39;，必须包含&quot;:&quot; 号&#39;</p><p>&nbsp; &nbsp; Raiserror 50001 @errorinfo &nbsp;&nbsp;</p><p>&nbsp; &nbsp; set @ResultCount= 0</p><p>&nbsp; &nbsp; return&nbsp;</p><p>&nbsp; end</p><p>&nbsp;set @ResultCount= 1</p><p>end</p><p>GO</p><p><br/></p>