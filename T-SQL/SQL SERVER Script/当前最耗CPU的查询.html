<p>--==================================================</p><p>--查看正在执行的SQL</p><p>SELECT</p><p>s.[session_id],</p><p>r.[start_time],</p><p>DATEDIFF(SECOND,r.start_time,GETDATE()) AS elapsed_seconds,</p><p>r.[status] AS RequestStatus,</p><p>DB_NAME(r.database_id) AS DatabaseName,</p><p>r.[wait_type],</p><p>r.[wait_resource],</p><p>r.[wait_time],</p><p>r.[reads],</p><p>r.[writes],</p><p>r.[logical_reads],</p><p>r.cpu_time,</p><p>r.total_elapsed_time,</p><p>s.[status] AS SessionStatus,</p><p>s.[host_name],</p><p>s.[original_login_name],</p><p>s.[nt_user_name],</p><p>s.[program_name],</p><p>s.[client_interface_name],</p><p>c.[client_net_address],</p><p>SUBSTRING (qt.text,</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;r.statement_start_offset/2,</p><p>(CASE WHEN r.statement_end_offset = -1</p><p>&nbsp; &nbsp; &nbsp; &nbsp;THEN LEN(CONVERT(NVARCHAR(MAX), qt.text)) * 2</p><p>ELSE r.statement_end_offset END -</p><p>r.statement_start_offset)/2) AS ExecutingSQL,</p><p>qp.query_plan</p><p>FROM sys.dm_exec_requests r</p><p>INNER JOIN sys.dm_exec_sessions s</p><p>ON r.session_id=s.session_id</p><p>LEFT JOIN sys.dm_exec_connections c</p><p>ON c.session_id=s.session_id</p><p>CROSS APPLY sys.dm_exec_sql_text(r.sql_handle) as qt</p><p>CROSS APPLY sys.dm_exec_query_plan(r.plan_handle) as qp</p><p>order by r.cpu_time desc</p><p><br/></p>