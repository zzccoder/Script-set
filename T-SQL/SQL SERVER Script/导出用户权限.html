<p></p><p style=";font-family:Calibri;font-size:10.5pt">--==========================导权限===============================</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">--this script will
list all explicit permission on object,database,database princpal and schema</p><p style=";font-family:Calibri;font-size:10.5pt">PRINT
&#39;-----------------------------------------DDL for permission on
object/column----------------&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">PRINT &#39;begin tran&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">PRINT &#39;&nbsp; begin try&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">DECLARE
@SqlStatement_Permission_object VARCHAR(1000)</p><p style=";font-family:Calibri;font-size:10.5pt">DECLARE proc_cur
CURSOR</p><p style=";font-family:Calibri;font-size:10.5pt">FOR</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; SELECT&nbsp;
CASE p.minor_id</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN 0</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN--grant permission to object
directly</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CASE p.state</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;G&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Grant&nbsp; &#39; + p.permission_name + &#39; on object::[&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +
SCHEMA_NAME(o.schema_id) + &#39;].[&#39; + o.name</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39;] to [&#39; + u.name +
&#39;]&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;D&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Deny&nbsp;&nbsp; &#39; + p.permission_name + &#39; on object::[&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +
SCHEMA_NAME(o.schema_id) + &#39;].[&#39; + o.name</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39;] to [&#39; + u.name +
&#39;]&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;R&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Revoke &#39; +
p.permission_name + &#39; on object::[&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +
SCHEMA_NAME(o.schema_id) + &#39;].[&#39; + o.name</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39;] to [&#39; + u.name +
&#39;]&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;W&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Grant&nbsp; &#39; + p.permission_name + &#39; on object::[&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +
SCHEMA_NAME(o.schema_id) + &#39;].[&#39; + o.name</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39;] to [&#39; + u.name +
&#39;] with grant option&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; END</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ELSE --grant permission on
columns</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CASE p.state</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;G&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Grant&nbsp; &#39; + p.permission_name + &#39; ([&#39; + c.name</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39;]) &#39; + &#39; on
object::[&#39; + SCHEMA_NAME(o.schema_id)</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39;].[&#39; + o.name + &#39;]
to [&#39; + u.name + &#39;]&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;D&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Deny&nbsp;&nbsp; &#39; + p.permission_name + &#39; ([&#39; + c.name</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39;]) &#39; + &#39; on
object::[&#39; + SCHEMA_NAME(o.schema_id)</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39;].[&#39; + o.name + &#39;]
to [&#39; + u.name + &#39;]&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;R&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Revoke &#39; +
p.permission_name + &#39; ([&#39; + c.name</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39;]) &#39; + &#39; on
object::[&#39; + SCHEMA_NAME(o.schema_id)</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39;].[&#39; + o.name + &#39;]
to [&#39; + u.name + &#39;]&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;W&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Grant&nbsp; &#39; + p.permission_name + &#39; ([&#39; + c.name</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39;]) &#39; + &#39; on
object::[&#39; + SCHEMA_NAME(o.schema_id)</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39;].[&#39; + o.name + &#39;]
to [&#39; + u.name</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39;] with grant
option&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; END</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; END&nbsp;
COLLATE DATABASE_DEFAULT</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; FROM&nbsp;&nbsp;&nbsp;
sys.database_permissions p</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INNER JOIN sys.database_principals
u ON ( p.grantee_principal_id = u.principal_id )</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INNER JOIN sys.objects o ON (
o.object_id = p.major_id )</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LEFT JOIN sys.columns c ON (
o.object_id = c.object_id</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AND
p.minor_id = c.column_id</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; WHERE&nbsp;&nbsp;
p.class = 1 --object/column</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AND u.name NOT IN ( &#39;dbo&#39;,
&#39;INFORMATION_SCHEMA&#39;, &#39;sys&#39; )</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; ORDER BY o.name ,</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; u.name ,</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; p.State</p><p style=";font-family:Calibri;font-size:10.5pt">OPEN proc_cur;&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">FETCH NEXT FROM
proc_cur&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">INTO
@SqlStatement_Permission_object</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">WHILE @@FETCH_STATUS
= 0</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; BEGIN&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PRINT
@SqlStatement_Permission_object&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FETCH NEXT FROM proc_cur INTO
@SqlStatement_Permission_object</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; END;&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">CLOSE proc_cur;&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">DEALLOCATE
proc_cur;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">PRINT CHAR(10) +
CHAR(10)</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">PRINT
&#39;-----------------------------------------DDL for permission on
database----------------&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">DECLARE
@SqlStatement_Permission_Database VARCHAR(1000)</p><p style=";font-family:Calibri;font-size:10.5pt">DECLARE proc_cur
CURSOR</p><p style=";font-family:Calibri;font-size:10.5pt">FOR</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; SELECT&nbsp;
CASE p.state</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;G&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Grant&nbsp; &#39; + p.permission_name + &#39; to [&#39; + u.name +
&#39;]&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;D&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Deny&nbsp;&nbsp; &#39; + p.permission_name + &#39; to [&#39; + u.name +
&#39;]&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;R&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Revoke &#39; +
p.permission_name + &#39; to [&#39; + u.name + &#39;]&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;W&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Grant&nbsp; &#39; + p.permission_name + &#39; to [&#39; + u.name</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39;] with grant option&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; END COLLATE DATABASE_DEFAULT</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; FROM&nbsp;&nbsp;&nbsp;
sys.database_permissions p</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INNER JOIN sys.database_principals
u ON ( p.grantee_principal_id = u.principal_id )</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; WHERE&nbsp;&nbsp;
p.class = 0 --database</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AND u.name NOT IN ( &#39;dbo&#39;,
&#39;INFORMATION_SCHEMA&#39;, &#39;sys&#39; )</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; ORDER BY u.name ,</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; p.State</p><p style=";font-family:Calibri;font-size:10.5pt">OPEN proc_cur;&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">FETCH NEXT FROM
proc_cur&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">INTO
@SqlStatement_Permission_Database</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">WHILE @@FETCH_STATUS
= 0</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; BEGIN&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PRINT &#39;&nbsp;&nbsp;&nbsp; &#39; + @SqlStatement_Permission_Database&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FETCH NEXT FROM proc_cur INTO
@SqlStatement_Permission_Database</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; END;&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">CLOSE proc_cur;&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">DEALLOCATE
proc_cur;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">PRINT CHAR(10)</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">PRINT
&#39;-----------------------------------------DDL for permission on database
principal----------------&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">DECLARE
@SqlStatement_Permission_DatabasePrincipal VARCHAR(1000)</p><p style=";font-family:Calibri;font-size:10.5pt">DECLARE proc_cur
CURSOR</p><p style=";font-family:Calibri;font-size:10.5pt">FOR</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; SELECT&nbsp;
CASE p.state</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;G&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Grant&nbsp; &#39; + p.permission_name + &#39; on user::&#39; +
u2.name</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39; to [&#39; + u1.name + &#39;]&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;D&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Deny&nbsp;&nbsp; &#39; + p.permission_name + &#39; on user::&#39; +
u2.name</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39; to [&#39; + u1.name + &#39;]&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;R&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Revoke &#39; +
p.permission_name + &#39; on user::&#39; + u2.name</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39; to [&#39; + u1.name + &#39;]&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;W&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Grant&nbsp; &#39; + p.permission_name + &#39; on user::&#39; +
u2.name</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39; to [&#39; + u1.name + &#39;]
with grant option&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; END COLLATE DATABASE_DEFAULT</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; FROM&nbsp;&nbsp;&nbsp;
sys.database_permissions p</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INNER JOIN sys.database_principals
u1 ON ( p.grantee_principal_id = u1.principal_id )</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INNER JOIN sys.database_principals
u2 ON ( p.major_id = u2.principal_id )</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; WHERE&nbsp;&nbsp;
p.class = 4 --database principal</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AND u1.name NOT IN ( &#39;dbo&#39;,
&#39;INFORMATION_SCHEMA&#39;, &#39;sys&#39; )</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; ORDER BY u2.name ,</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; u1.name ,</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; p.State</p><p style=";font-family:Calibri;font-size:10.5pt">OPEN proc_cur;&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">FETCH NEXT FROM
proc_cur&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">INTO
@SqlStatement_Permission_DatabasePrincipal</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">WHILE @@FETCH_STATUS
= 0</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; BEGIN&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PRINT &#39;&nbsp;&nbsp;&nbsp; &#39; +
@SqlStatement_Permission_DatabasePrincipal&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FETCH NEXT FROM proc_cur INTO
@SqlStatement_Permission_DatabasePrincipal</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; END;&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">CLOSE proc_cur;&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">DEALLOCATE
proc_cur;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">PRINT CHAR(10)</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">PRINT
&#39;-----------------------------------------DDL for permission on
Schema----------------&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">DECLARE
@SqlStatement_Permission_Schema VARCHAR(1000)</p><p style=";font-family:Calibri;font-size:10.5pt">DECLARE proc_cur
CURSOR</p><p style=";font-family:Calibri;font-size:10.5pt">FOR</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; SELECT&nbsp;
CASE p.state</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;G&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Grant&nbsp; &#39; + p.permission_name + &#39; on Schema::&#39; +
s.name</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39; to [&#39; + u.name + &#39;]&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;D&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Deny&nbsp;&nbsp; &#39; + p.permission_name + &#39; on Schema::&#39; +
s.name</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39; to [&#39; + u.name + &#39;]&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;R&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Revoke &#39; +
p.permission_name + &#39; on Schema::&#39; + s.name</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39; to [&#39; + u.name + &#39;]&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;W&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Grant&nbsp; &#39; + p.permission_name + &#39; on Schema::&#39; +
s.name</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39; to [&#39; + u.name + &#39;] with
grant option&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; END COLLATE DATABASE_DEFAULT</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; FROM&nbsp;&nbsp;&nbsp;
sys.database_permissions p</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INNER JOIN sys.database_principals
u ON ( p.grantee_principal_id = u.principal_id )</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INNER JOIN sys.schemas s ON (
p.major_id = s.schema_id )</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; WHERE&nbsp;&nbsp;
p.class = 3 --schema</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AND u.name NOT IN ( &#39;dbo&#39;,
&#39;INFORMATION_SCHEMA&#39;, &#39;sys&#39; )</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; ORDER BY s.name ,</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; u.name ,</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; p.State</p><p style=";font-family:Calibri;font-size:10.5pt">OPEN proc_cur;&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">FETCH NEXT FROM
proc_cur&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">INTO
@SqlStatement_Permission_Schema</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">WHILE @@FETCH_STATUS
= 0</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; BEGIN&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PRINT &#39;&nbsp;&nbsp;&nbsp; &#39; + @SqlStatement_Permission_Schema&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FETCH NEXT FROM proc_cur INTO
@SqlStatement_Permission_Schema</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; END;&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">CLOSE proc_cur;&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">DEALLOCATE
proc_cur;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">PRINT CHAR(10)</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">--24 = 对称密钥</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">-- = 证书</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">--26 = 非对称密钥</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">--this script will
list all explicit permission on certificate,database,database princpal and
schema</p><p style=";font-family:Calibri;font-size:10.5pt">PRINT
&#39;-----------------------------------------DDL for permission on symmetric
key,certificate,,asymmetric key----------------&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">DECLARE
@SqlStatement_Permission_Key VARCHAR(1000)</p><p style=";font-family:Calibri;font-size:10.5pt">DECLARE proc_cur
CURSOR</p><p style=";font-family:Calibri;font-size:10.5pt">FOR</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; SELECT&nbsp;
CASE p.class</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN 24</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN --symmetric key</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CASE p.state</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;G&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Grant&nbsp; &#39; + p.permission_name</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39; on symmetric
key::[&#39; + s.name + &#39;] to [&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + u.name + &#39;]&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;D&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Deny&nbsp;&nbsp; &#39; + p.permission_name</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39; on symmetric
key::[&#39; + s.name + &#39;] to [&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + u.name + &#39;]&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;R&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Revoke &#39; +
p.permission_name</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39; on symmetric
key::[&#39; + s.name + &#39;] to [&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + u.name + &#39;]&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;W&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Grant&nbsp; &#39; + p.permission_name</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39; on symmetric
key::[&#39; + s.name + &#39;] to [&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + u.name + &#39;] with
grant option&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; END</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN 25</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN--certificate</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CASE p.state</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;G&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Grant&nbsp; &#39; + p.permission_name + &#39; on certificate::[&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + c.name + &#39;] to [&#39; +
u.name + &#39;]&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;D&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Deny&nbsp;&nbsp; &#39; + p.permission_name + &#39; on certificate::[&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + c.name + &#39;] to [&#39; +
u.name + &#39;]&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;R&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Revoke &#39; +
p.permission_name + &#39; on certificate::[&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + c.name + &#39;] to [&#39; +
u.name + &#39;]&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;W&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Grant&nbsp; &#39; + p.permission_name + &#39; on certificate::[&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + c.name + &#39;] to [&#39; +
u.name + &#39;] with grant option&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; END</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN 26</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN&nbsp; --asymmetric key</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CASE p.state</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;G&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Grant&nbsp; &#39; + p.permission_name</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39; on asymmetric
key::[&#39; + a.name + &#39;] to [&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + u.name + &#39;]&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;D&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Deny&nbsp;&nbsp; &#39; + p.permission_name</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39; on asymmetric
key::[&#39; + a.name + &#39;] to [&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + u.name + &#39;]&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;R&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Revoke &#39; +
p.permission_name</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39; on asymmetric
key::[&#39; + a.name + &#39;] to [&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + u.name + &#39;]&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN &#39;W&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; THEN &#39;Grant&nbsp; &#39; + p.permission_name</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + &#39; on asymmetric
key::[&#39; + a.name + &#39;] to [&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + u.name + &#39;] with
grant option&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; END</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; END COLLATE DATABASE_DEFAULT</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; FROM&nbsp;&nbsp;&nbsp;
sys.database_permissions p</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INNER JOIN sys.database_principals
u ON ( p.grantee_principal_id = u.principal_id )</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LEFT JOIN sys.symmetric_keys s ON (
s.symmetric_key_id = p.major_id )</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LEFT JOIN sys.certificates c ON (
c.certificate_id = p.major_id )</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LEFT JOIN sys.asymmetric_keys a ON
( a.asymmetric_key_id = p.major_id )</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; WHERE&nbsp;&nbsp;
p.class IN ( 24, 25, 26 ) --symmetric key,certificate,,asymmetric key</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AND u.name NOT IN ( &#39;dbo&#39;,
&#39;INFORMATION_SCHEMA&#39;, &#39;sys&#39; )</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; ORDER BY a.name ,</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; u.name ,</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; p.State</p><p style=";font-family:Calibri;font-size:10.5pt">OPEN proc_cur;&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">FETCH NEXT FROM
proc_cur&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">INTO
@SqlStatement_Permission_Key</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">WHILE @@FETCH_STATUS
= 0</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; BEGIN&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PRINT &#39;&nbsp;&nbsp;&nbsp; &#39; + @SqlStatement_Permission_Key&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FETCH NEXT FROM proc_cur INTO
@SqlStatement_Permission_Key</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; END;&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">CLOSE proc_cur;&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">DEALLOCATE
proc_cur;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">PRINT CHAR(10)</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">PRINT
&#39;-----------------------------------------DDL for Alter authorization against
object----------------&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">DECLARE
@SqlStatement_AlterAuthorization VARCHAR(1000)</p><p style=";font-family:Calibri;font-size:10.5pt">DECLARE proc_cur
CURSOR</p><p style=";font-family:Calibri;font-size:10.5pt">FOR</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; SELECT&nbsp;
&#39;Alter authorization on [&#39; + SCHEMA_NAME(o.schema_id) + &#39;].[&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + o.name + &#39;] to [&#39; + u.name + &#39;]&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; FROM&nbsp;&nbsp;&nbsp;
sys.database_principals u</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INNER JOIN sys.objects o ON (
o.principal_id = u.principal_id )</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; WHERE&nbsp;&nbsp;
o.principal_id IS NOT NULL</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; ORDER BY o.name ,</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; u.name</p><p style=";font-family:Calibri;font-size:10.5pt">OPEN proc_cur;&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">FETCH NEXT FROM
proc_cur&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">INTO
@SqlStatement_AlterAuthorization</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">WHILE @@FETCH_STATUS
= 0</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; BEGIN&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PRINT &#39;&nbsp;&nbsp;&nbsp; &#39; + @SqlStatement_AlterAuthorization&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FETCH NEXT FROM proc_cur INTO
@SqlStatement_AlterAuthorization</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;&nbsp;&nbsp; END;&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">CLOSE proc_cur;&nbsp;&nbsp;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">DEALLOCATE
proc_cur;&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">PRINT &#39;&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">PRINT &#39;&nbsp;&nbsp;&nbsp; goto successed&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">PRINT &#39;&nbsp; end try&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">PRINT &#39;&nbsp; begin catch&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">PRINT &#39;&nbsp;&nbsp;&nbsp; print ERROR_MESSAGE()&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">PRINT &#39;&nbsp;&nbsp;&nbsp; goto failed&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">PRINT &#39;&nbsp; end catch&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">PRINT &#39;&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">PRINT &#39;successed:&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">PRINT &#39;&nbsp; commit&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">PRINT &#39;&nbsp; print &#39;&#39;successed&#39;&#39;&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">PRINT &#39;&nbsp; return&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">PRINT &#39;&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">PRINT &#39;failed:&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">PRINT &#39;&nbsp; rollback&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">PRINT &#39;&nbsp; print &#39;&#39;failed&#39;&#39;&#39;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p><p style=";font-family:Calibri;font-size:10.5pt">&nbsp;</p>