<p>--摘抄自http://blogs.msdn.com/b/sqlserverstorageengine/archive/2009/01/12/tempdb-monitoring-and-troubleshooting-out-of-space.aspx</p><p>-- This DMV query shows currently executing tasks and&nbsp;</p><p>-- tempdb space usage</p><p>-- Once you have isolated the task(s) that are generating lots&nbsp;</p><p>-- of internal object allocations,&nbsp;</p><p>-- you can even find out which TSQL statement and its query plan&nbsp;</p><p>-- for detailed analysis</p><p><br/></p><p>&nbsp;</p><p><br/></p><p>&nbsp;</p><p>SELECT TOP 10</p><p>t1.session_id,&nbsp;</p><p>t1.request_id,&nbsp;</p><p>t1.task_alloc,</p><p>t1.task_dealloc, &nbsp;</p><p>(</p><p>SELECT SUBSTRING(TEXT, t2.statement_start_offset/2 + 1,</p><p>(CASE WHEN statement_end_offset = -1&nbsp;</p><p>&nbsp; &nbsp; &nbsp; THEN LEN(CONVERT(NVARCHAR(MAX),TEXT)) * 2&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ELSE statement_end_offset&nbsp;</p><p>&nbsp; &nbsp; &nbsp; END - t2.statement_start_offset)/2)</p><p>&nbsp; FROM sys.dm_exec_sql_text(sql_handle)</p><p>) AS query_text,</p><p>(SELECT query_plan FROM sys.dm_exec_query_plan(t2.plan_handle)) AS query_plan</p><p>FROM &nbsp; &nbsp; &nbsp;</p><p>(SELECT session_id, request_id,</p><p>SUM(internal_objects_alloc_page_count + &nbsp; user_objects_alloc_page_count) AS task_alloc,</p><p>SUM (internal_objects_dealloc_page_count + user_objects_dealloc_page_count) AS task_dealloc</p><p>&nbsp; &nbsp; &nbsp; &nbsp;FROM sys.dm_db_task_space_usage&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;GROUP BY session_id, request_id</p><p>) AS t1,&nbsp;</p><p>sys.dm_exec_requests AS t2</p><p>WHERE t1.session_id = t2.session_id AND&nbsp;</p><p>(t1.request_id = t2.request_id) AND&nbsp;</p><p>&nbsp; &nbsp; &nbsp; t1.session_id &gt; 50</p><p>ORDER BY t1.task_alloc DESC</p>