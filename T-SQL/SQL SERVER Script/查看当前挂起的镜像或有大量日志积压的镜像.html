<p></p><p>--=============================================================================</p><p>--查看当前挂起的镜像或有大量日志积压的镜像</p><p>WITH tmp AS(</p><p>SELECT</p><p>ROW_NUMBER()OVER(PARTITION BY Database_id ORDER BY local_time DESC) AS RID,</p><p>*</p><p>FROM msdb.dbo.dbm_monitor_data</p><p>)</p><p>SELECT * INTO #MirrorResult FROM tmp</p><p>WHERE RID=1</p><p>AND (</p><p>([status]&lt;&gt;2&nbsp;</p><p>AND [status]&lt;&gt;4)&nbsp;</p><p>OR send_queue_size&gt;30000&nbsp;</p><p>OR redo_queue_size&gt;30000)</p>